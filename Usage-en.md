# Router

- config rules

```java
// create a class implements with RouterCreator and add it in Router
Router.addRouteCreator(new RouteCreator {

       @Override
       public Map<String, RouteMap> createRouteRules() {
           Map<String,RouteMap> routes = new HashMap<>();
           // map-> key     : route rule,to mapping with scheme while you want to open
           // map-> value   : valies,to indicate while Activity shoule be opened with this rule.And all of types and keys you want to put in bundle
           routes.put("haoge://main",
                   new RouteMap(ParamsActivity.class)
                   .addParam("price",RouteMap.FLOAT)
                   .addParam("bookName",RouteMap.STRING)
           );
           routes.put("haogestudio://main",
                   new RouteMap("com.lzh.nonview.demo.RegisterActivity")
                   );
           return routes;
       }
   });
```

- config interceptor & callback
Set a global interceptor for Router:

```
Router.setGlobalRouteInterceptor(new RouteInterceptor() {

    @Override
    public boolean intercept(Uri uri, ActivityRouteBundleExtras extras, Context context) {
        // The open route event should be intercepted with return true
        return !DataManager.INSTANCE.isLogin();
    }

    @Override
    public void onIntercepted(Uri uri, ActivityRouteBundleExtras extras, Context context) {
        // As the method intercept returns true,it will be interrupted and this method will be invoked
        Toast.makeText(App.this, "Please login first", Toast.LENGTH_SHORT).show();
        Intent loginIntent = new Intent(context,LoginActivity.class);
        loginIntent.putExtra("uri",uri);
        loginIntent.putExtra("extras",extras);
        context.startActivity(loginIntent);
    }
});
```
set a global configuration for Router:
```java
// create a subclass of RouterCallback and add it to Router
Router.setRouteCallback(new RouteCallback() {

    @Override
    public void notFound(Uri uri, NotFoundException e) {
        // there are two scenes of not found.one is no route rule had matched,and another is the match activity is not found,
        Toast.makeText(App.this, e.getNotFoundName() + " not find", Toast.LENGTH_SHORT).show();
    }

    @Override
    public void onOpenSuccess(Uri uri, String clzName) {
        // to trace which activity had been opened
        Toast.makeText(App.this, String.format("Launch activity %s success",clzName), Toast.LENGTH_SHORT).show();
    }

    @Override
    public void onOpenFailed(Uri uri, Exception e) {
        // other un-catch exception when open
    }
});
```

Or you need config it with a special url

```java
Router.create(url).getActivityRoute().addInterceptor(interceptor);
```

```java
Router.create(url).setCallback(callback).open(context);
```

- Open with Router

There are two ways to open with Router:
1.launch with a url directly:

```java
Router.create(url).open(context);
```

*in this way,you call only carry a base type of java and String to pass,like int/boolean/String .etc*

*In version 0.6.it also support types of ArrayList<String> & ArrayList<Integer>*
2.Open with some extras data with Router

```java
Bundle extras = new Bundle();
...
Router.create("jumei://main").getActivityRoute()
        .addExtras(extras)// add extras data
        .addInterceptor(interceptor)
        .requestCode(100)
        .addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP)
        .setAnim(R.anim.anim_fade_in,R.anim.anim_fade_out)
        .open(this);
```

*in this way,You can put some extras data in the bundle that it unable to carry with a simple URLs,attention:scheme can't be http/https*

3.get intent for some complex context:

```java
Intent intent = Router.create("haoge://main").getActivityRoute().createIntent(context);
```

- Usage of combined with Parceler

if you had added Parceler framework,and also add the compile-time annotation framework like below:and you'll be able to use an annotation called *RouterRule* to generate your route rules automatically
```java
apt 'org.lzh.nonview.router:router-compiler:0.3'
```

1.Add *RouterRule* to Activity which one should be config rule

```java
// RouterRule supports two fields:
// one is called value:to indicate which route rule should be generated.can't be null
// and another is called pack:to indicate which package name should be used for generate class.if not set,it should generate with a default package name
@RouterRule("haoge://haoge.cn/parceler")
public class ParcelerActivity extends Activity {

    @Arg
    String username;
    @Arg
    String address;
}
```

2.remember to make project while you had added a rule with RouterRule,this class was generated by compile-time annotation framework:

```java
public class RouterRuleCreator implements RouteCreator {
  @Override
  public Map<String, RouteMap> createRouteRules() {
    Map<String,RouteMap> routes = new HashMap<>();
    routes.put("haoge://haoge.cn/parceler",new RouteMap(ParcelerActivity.class).addParam("address",RouteMap.STRING).addParam("username",RouteMap.STRING));;
    return routes;
  }
}
```

3.add rules to Router by this way

```java
Router.addRouteCreator(new RouterRuleCreator());
```

have fun

